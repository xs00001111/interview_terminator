<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compact UI Demo - Interview Terminator</title>
    <style>
        :root {
            /* Apple Dark Mode Inspired Palette */
            --system-background-dark: #3A3A3C; /* Changed to lighter grey for better visibility */
            --secondary-system-background-dark: #2C2C2E;
            --tertiary-system-background-dark: #3A3A3C;
            
            --text-primary-dark: rgba(255, 255, 255, 0.92);
            --text-secondary-dark: rgba(235, 235, 245, 0.65);
            --text-tertiary-dark: rgba(235, 235, 245, 0.35);
            
            --accent-apple-blue: #0A84FF;
            --accent-apple-blue-hover: #0073E6; /* Slightly darker blue for hover */
            --accent-apple-green: #30D158;
            --accent-apple-green-hover: #28B34B;
            --accent-apple-red: #FF453A;
            --accent-apple-red-hover: #E6362D;
            --accent-foreground-dark: #FFFFFF;

            --separator-dark: rgba(84, 84, 88, 0.65);
            --fill-primary-dark: rgba(120, 120, 128, 0.36); /* For subtle button backgrounds, etc. */
            --fill-secondary-dark: rgba(120, 120, 128, 0.24);
            --fill-tertiary-dark: rgba(120, 120, 128, 0.18);

            /* UI Element Specific */
            --control-background-dark: rgba(120, 120, 128, 0.12); /* For general controls */
            --control-background-hover-dark: rgba(120, 120, 128, 0.20);
            --control-border-dark: rgba(120, 120, 128, 0.25);

            /* Legacy variables (map or remove later if not needed) */
            --primary: var(--accent-apple-blue);
            --primary-hover: var(--accent-apple-blue-hover);
            --primary-foreground: var(--accent-foreground-dark);
            --destructive: var(--accent-apple-red);
            --destructive-hover: var(--accent-apple-red-hover);
            --destructive-foreground: var(--accent-foreground-dark);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            color: var(--text-primary-dark);
            height: 100vh;
            overflow: hidden;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.02) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.01) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Compact draggable bar - Apple Material Style */
        .compact-bar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.4); /* More transparent glass effect */
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-radius: 12px; /* Slightly more rounded */
            padding: 7px 14px; /* Adjusted padding */
            display: flex;
            align-items: center;
            gap: 10px; /* Adjusted gap */
            box-shadow: 0 0 0 0.5px rgba(255, 255, 255, 0.1), /* Glass border */
                        0px 8px 32px rgba(0, 0, 0, 0.4), /* Main shadow */
                        inset 0 1px 0 rgba(255, 255, 255, 0.1); /* Inner highlight */
            border: 0.5px solid rgba(255, 255, 255, 0.15); /* Glass border */
            cursor: move;
            user-select: none;
            z-index: 1000;
            transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease-out;
            min-width: auto; /* Allow width to be more flexible initially */
        }

        .compact-bar:hover {
            background: rgba(30, 30, 30, 0.5); /* Slightly more opaque on hover */
            box-shadow: 0 0 0 0.5px rgba(255, 255, 255, 0.15), 
                        0px 12px 40px rgba(0, 0, 0, 0.5), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.15);
            /* transform: translateX(-50%) translateY(-1px); Removed subtle lift for now, can add back if desired */
        }

        /* Logo/Brand */
        .brand {
            display: flex;
            align-items: center;
            gap: 8px; /* Increased gap */
            /* font-weight and font-size removed, will be handled by icon or specific text elements */
            color: var(--text-primary-dark);
        }


        /* Action buttons container */
        .action-buttons {
            display: flex;
            align-items: center;
            gap: 8px; /* Increased gap for better spacing */
            flex-grow: 1;
            justify-content: center;
        }

        /* General Action buttons (for icon-only buttons like expand) */
        .action-btn {
            background: transparent; /* Fully transparent by default */
            border: none;
            padding: 6px; /* Slightly reduced padding */
            border-radius: 5px; /* More rectangular */
            cursor: pointer;
            transition: background-color 0.2s ease-out, transform 0.15s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px; /* Adjusted size */
            height: 30px;
            position: relative;
            color: var(--text-secondary-dark); /* Default icon color */
        }

        /* Window Controls */
        .window-controls {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 6px;
            margin-right: 6px;
        }


        .window-control-btn
         {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;    
        }

        .window-control-btn svg
         {
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .window-controls:hover .window-control-btn svg,
        .window-controls:hover  {
            opacity: 1;
        }

        .minimize-btn {
            background-color: #ffbd2e;
        }

        .minimize-btn:hover {
            background-color: #ffaa00;
        }

        .minimize-btn svg {
            color: #995700;
        }

        .maximize-btn {
            background-color: #28ca42;
        }

        .maximize-btn:hover {
            background-color: #1aad34;
        }

        .maximize-btn svg {
            color: #0d5016;
        }

        .close-popup-btn {
            color: #ff5757;
        }

        .menu-control-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            transition: all 0.2s ease; 
            color: #ff5757; 
        }

        /* Header Controls Layout */
        .ai-popup-header, .transcript-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background-color: var(--control-background-hover-dark);
            /* transform: scale(1.05); /* Subtle scale on hover */
        }

        .action-btn.active {
            background-color: var(--fill-secondary-dark); /* More prominent active state */
            color: var(--text-primary-dark);
        }

        .action-btn svg {
            width: 17px; /* Standardized icon size */
            height: 17px;
            fill: currentColor;
        }

        .ai-btn {
            background-color: var(--accent-apple-blue);
            color: var(--accent-foreground-dark);
            min-width: 150px; /* Increased width for AI Answer button */
            padding: 6px 12px !important; /* Adjusted padding */
            height: 30px !important; /* Fixed height for consistency */
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            font-size: 13px; /* Apple standard UI font size */
            font-weight: 500;
            border-radius: 5px; /* More rectangular */
            gap: 5px; /* Adjusted gap */
            flex-wrap: nowrap;
            white-space: nowrap;
            transition: background-color 0.2s ease-out, transform 0.15s ease-out;
        }

        .ai-btn:hover {
            background-color: var(--accent-apple-blue-hover) !important;
            /* transform: scale(1.03) !important; /* Subtle hover effect */
        }

        .ai-btn.active {
            background-color: var(--accent-apple-blue-hover); /* Can be same as hover or slightly different */
            color: var(--accent-foreground-dark);
            /* transform: none; */ 
        }

        .listen-now-btn {
            background-color: var(--fill-primary-dark); /* Using a fill color for default state */
            color: var(--text-primary-dark);
            padding: 6px 12px !important; /* Keep vertical padding, min-width will handle width */
            min-width: 220px; /* Significantly wider */
            height: 30px !important;
            border-radius: 5px; /* More rectangular */
            font-weight: 500;
            font-size: 13px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 5px;
            /* margin-right: 6px; /* Adjusted margin */
            flex-wrap: nowrap;
            white-space: nowrap;
            transition: background-color 0.2s ease-out, color 0.2s ease-out, transform 0.15s ease-out;
        }

        .listen-now-btn:hover {
            background-color: var(--fill-secondary-dark) !important;
            /* transform: scale(1.03) !important; */
        }

        .listen-now-btn.active {
            background-color: var(--accent-apple-red) !important;
            color: var(--accent-foreground-dark) !important;
            box-shadow: none; /* Removed inset shadow for flatter Apple style */
        }

        .listen-now-btn.active:hover {
            background-color: var(--accent-apple-red-hover) !important;
        }

        .listen-now-btn svg {
            width: 17px; /* Standardized icon size */
            height: 17px;
            fill: currentColor;
        }

        /* Removed status indicator - redundant with button states */

        /* AI Suggestions Popup (ai-popup) - Apple Aesthetic */
        .ai-popup {
            position: fixed;
            top: 80px; /* Position below compact bar */
            left: 50%;
            transform: translateX(-50%) scale(0.98) translateY(-10px); /* Center horizontally and dropdown animation */
            transform-origin: top center;
            background: rgba(20, 20, 20, 0.3); /* More transparent glass effect */
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-radius: 14px;
            padding: 0; /* Header/content will manage padding */
            width: calc(100vw - 40px); /* Full width minus margins */
            max-width: 800px;
            max-height: calc(40vh - 40px); /* Take up about 40% of viewport height */
            box-shadow: 0 0 0 0.5px rgba(255, 255, 255, 0.1), /* Glass border */
                        0 16px 64px rgba(0, 0, 0, 0.4), /* Main shadow */
                        inset 0 1px 0 rgba(255, 255, 255, 0.1); /* Inner highlight */
            border: 0.5px solid rgba(255, 255, 255, 0.15); /* Glass border */
            z-index: 999; /* Higher z-index for prominence */
            opacity: 0;
            visibility: hidden;
            display: flex; /* Use flex for header/content structure */
            flex-direction: column;
            transition: opacity 0.25s ease-out, transform 0.25s ease-out, visibility 0.25s ease-out;
        }

        .ai-popup.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) scale(1) translateY(0);
        }

        .ai-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            border-bottom: 1px solid var(--border-light-dark);
            flex-shrink: 0;
        }

        .ai-popup-title {
            font-weight: 600;
            color: var(--text-primary-dark);
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .ai-popup-title svg { /* Assuming icon in title */
            width: 17px;
            height: 17px;
            fill: var(--text-secondary-dark);
        }



        /* Content area for AI popup, if it's just a list of answer-cards */
        .ai-popup-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .answer-card { /* This is inside .ai-popup-content */
            background-color: var(--fill-tertiary-dark);
            border-radius: 10px; /* Slightly less rounded than panel */
            padding: 12px 14px;
            border: 1px solid var(--border-ultralight-dark);
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .answer-card:hover {
            background-color: var(--fill-secondary-dark);
            border-color: var(--border-light-dark);
        }

        .answer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .answer-title {
            color: var(--text-primary-dark);
            font-weight: 500;
            font-size: 14px;
        }

        .answer-confidence {
            background-color: var(--fill-secondary-dark); /* Default/High confidence */
            color: var(--text-secondary-dark);
            padding: 3px 7px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            border: 1px solid var(--border-light-dark);
        }

        .answer-confidence.medium {
            background-color: var(--accent-apple-orange-fill); 
            color: var(--accent-apple-orange-text); 
            border-color: var(--accent-apple-orange-border);
        }

        .answer-confidence.low {
            background-color: var(--accent-apple-red-fill); 
            color: var(--accent-apple-red-text); 
            border-color: var(--accent-apple-red-border);
        }

        .answer-text {
            color: var(--text-secondary-dark);
            line-height: 1.55;
            font-size: 13px;
            margin-bottom: 10px;
            /* font-style: italic; /* Removed italic for cleaner look */
        }

        .answer-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Buttons within answer cards */
        .speak-btn, .elaborate-btn, .copy-btn {
            border: 1px solid var(--control-border-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            padding: 6px 10px;
            border: none;
            border-radius: 7px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-out;
            background-color: var(--fill-quaternary-dark); /* Default for action buttons in card */
            color: var(--text-primary-dark);
            border: 1px solid var(--control-border-dark);
        }
        .speak-btn:hover, .elaborate-btn:hover, .copy-btn:hover {
            background-color: var(--fill-tertiary-dark);
        }
        .speak-btn:active, .elaborate-btn:active, .copy-btn:active {
            background-color: var(--fill-secondary-dark);
            transform: scale(0.98);
        }
        .speak-btn:hover, .elaborate-btn:hover, .copy-btn:hover {
            background-color: var(--fill-tertiary-dark);
        }
        .speak-btn.primary {
            background-color: var(--accent-apple-blue); /* Primary action in card */
            color: var(--accent-foreground-dark);
        }
        .speak-btn.primary:hover {
            background-color: var(--accent-apple-blue-hover);
        }
        .elaborate-btn, .copy-btn {
            background-color: var(--fill-tertiary-dark);
        }
        .elaborate-btn:hover, .copy-btn:hover {
            background-color: var(--fill-secondary-dark);
        }
        .elaborate-btn:active, .copy-btn:active {
            background-color: var(--fill-primary-dark);
            transform: scale(0.98);
        }
        .speak-btn svg, .elaborate-btn svg, .copy-btn svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .hotkey-hint {
            font-size: 0.8em;
            color: var(--primary-foreground);
            opacity: 0.7;
            margin-left: 4px;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            pointer-events: none;
        }

        .action-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Expand button styling */
        .expand-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.8);
        }

        .expand-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .expand-btn.active {
            background: rgba(255, 255, 255, 0.2);
            color: var(--primary-foreground);
        }

        /* Expanded menu panel */
        .expanded-menu {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.3); /* More transparent glass effect */
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-radius: 10px;
            padding: 20px;
            min-width: 300px;
            box-shadow: 0 0 0 0.5px rgba(255, 255, 255, 0.1), /* Glass border */
                        0 20px 80px rgba(0, 0, 0, 0.4), /* Main shadow */
                        inset 0 1px 0 rgba(255, 255, 255, 0.1); /* Inner highlight */
            border: 0.5px solid rgba(255, 255, 255, 0.15); /* Glass border */
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transform: translateX(-50%) translateY(-10px);
            transition: all 0.3s ease;
        }

        .expanded-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .menu-title {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }

        .menu-section {
            margin-bottom: 20px;
        }

        .menu-section:last-child {
            margin-bottom: 0;
        }

        .menu-section-title {
            font-size: 12px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
            margin-bottom: 4px;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .menu-item-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item-icon {
            width: 16px;
            height: 16px;
            color: var(--primary-foreground);
        }

        .menu-item-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        .menu-item-action {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--secondary), var(--secondary-hover));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary-foreground);
            font-weight: bold;
            font-size: 14px;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            font-size: 14px;
        }

        .user-status {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .login-prompt {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .login-btn {
            background: var(--accent-apple-blue);
            color: var(--accent-foreground-dark);
            border: 1px solid var(--accent-apple-blue);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.15s ease;
            margin-top: 12px;
            box-shadow: 0 2px 8px rgba(10, 132, 255, 0.2);
        }

        .login-btn:hover {
            background: var(--accent-apple-blue-hover);
            border-color: var(--accent-apple-blue-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(10, 132, 255, 0.3);
        }

        .login-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(10, 132, 255, 0.2);
        }

        /* Preferences Panel Styling - Apple Aesthetic */
        .preferences-panel {
            position: fixed;
            top: 70px; /* Position below compact bar */
            left: 20px; /* Align to left, matching original intent for #preferencesPanel */
            transform: none; /* Remove translateX if fixed left */
            background: rgba(20, 20, 20, 0.3); /* More transparent glass effect */
            backdrop-filter: blur(40px) saturate(180%); 
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-radius: 14px; /* Standard Apple radius */
            padding: 18px; /* Adjusted padding */
            width: 360px; /* Fixed width */
            max-width: 90vw;
            box-shadow: 0 0 0 0.5px rgba(255, 255, 255, 0.1), /* Glass border */
                        0 16px 64px rgba(0, 0, 0, 0.4), /* Main shadow */
                        inset 0 1px 0 rgba(255, 255, 255, 0.1); /* Inner highlight */
            border: 0.5px solid rgba(255, 255, 255, 0.15); /* Glass border */
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            /* transform: translateY(-10px) scale(0.98); /* Adjusted transform for entry */
            transition: opacity 0.25s ease-out, transform 0.25s ease-out, visibility 0.25s ease-out;
        }

        .preferences-panel.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .preferences-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px; /* Reduced margin */
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-light-dark); /* Lighter border */
        }

        .preferences-title {
            font-weight: 600; /* Semibold */
            color: var(--text-primary-dark);
            font-size: 17px; /* Standard title size */
        }
        /* Close button for preferences panel, if needed, can reuse .popup-close-btn or make specific */

        .preferences-content {
            display: flex;
            flex-direction: column;
            gap: 12px; /* Reduced gap between items */
        }

        .preference-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0; /* Adjusted padding */
            border-bottom: 1px solid var(--border-ultralight-dark); /* Very subtle separator */
        }
        .preference-item:last-child {
            border-bottom: none;
        }

        .preference-item label:first-child {
            color: var(--text-primary-dark);
            font-size: 14px;
            flex-grow: 1;
        }

        /* Apple-like Toggle Switch Styling */
        .switch {
            position: relative;
            display: inline-block;
            width: 51px; /* Standard Apple width */
            height: 31px; /* Standard Apple height */
            flex-shrink: 0;
        }

        .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--fill-tertiary-dark); /* Off state background */
            transition: .3s ease-in-out;
            border-radius: 31px; /* Fully rounded */
            border: 1px solid var(--border-opaque-dark);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 27px; /* Knob size */
            width: 27px;
            left: 1px;
            bottom: 1px;
            background-color: white;
            transition: .3s ease-in-out;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2), 0 1px 1px rgba(0,0,0,0.1);
        }

        input:checked + .slider {
            background-color: var(--accent-apple-green); /* Green for active */
            border-color: var(--accent-apple-green);
        }



        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* .slider.round removed as default is round */
        /* .slider.round:before removed as default is round */

        /* Select Dropdown Styling */
        .preference-select {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            min-width: 180px;
            cursor: pointer;
            transition: background 0.2s ease, border-color 0.2s ease;
            appearance: none; /* Remove default arrow */
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='rgba(255,255,255,0.7)'%3e%3cpath d='M7,10L12,15L17,10H7Z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        .preference-select:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .preference-select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px var(--secondary-hover-transparent); /* Updated to use a variable, assuming --secondary-hover-transparent will be defined or this is a placeholder */
        }

        .context-upload-section {
            margin-top: 20px;
            padding-top: 20px;
        }

        .context-upload-section .preference-item-label {
            color: rgba(255, 255, 255, 0.85);
            font-size: 14px;
            margin-bottom: 8px;
            display: block;
        }

        .file-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            display: none; /* Hide default input */
        }

        .file-input-button {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s ease, border-color 0.2s ease;
            white-space: nowrap;
        }

        .file-input-button:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .file-name-display {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-grow: 1;
            padding: 8px 0;
        }

        .clear-file-btn {
            background: none;
            border: none;
            color: var(--destructive); /* Assuming --destructive is for this kind of red */
            cursor: pointer;
            font-size: 12px;
            padding: 4px;
            margin-left: 5px;
            visibility: hidden; /* Hidden by default */
        }
        .clear-file-btn:hover {
            color: var(--destructive-hover); /* Assuming --destructive-hover for hover state */
        }

        .context-section-title {
            font-size: 16px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.85);
            margin-top: 20px; /* Add some space above the title */
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Transcript Panel Styling - Apple Aesthetic */
        .transcript-panel {
            position: fixed;
            top: calc(40vh + 20px); /* Position directly below AI popup with no gap */
            left: 50%;
            transform: translateX(-50%) scale(0.98) translateY(-10px); /* Center horizontally and dropdown animation */
            transform-origin: top center;
            background: rgba(20, 20, 20, 0.3); /* More transparent glass effect */
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-radius: 14px;
            padding: 0; /* Remove padding, header/content will manage */
            width: calc(100vw - 40px); /* Full width minus margins */
            max-width: 800px;
            max-height: calc(60vh - 40px); /* Take up remaining viewport height */
            box-shadow: 0 0 0 0.5px rgba(255, 255, 255, 0.1), /* Glass border */
                        0 16px 64px rgba(0, 0, 0, 0.4), /* Main shadow */
                        inset 0 1px 0 rgba(255, 255, 255, 0.1); /* Inner highlight */
            border: 0.5px solid rgba(255, 255, 255, 0.15); /* Glass border */
            z-index: 995; /* Lower z-index than AI popup */
            opacity: 0;
            visibility: hidden;
            display: flex; /* Use flex for header/content structure */
            flex-direction: column;
            transition: opacity 0.25s ease-out, transform 0.25s ease-out, visibility 0.25s ease-out;
        }

        .transcript-panel.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) scale(1) translateY(0);
        }

        .transcript-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px; /* Consistent padding */
            border-bottom: 1px solid var(--border-light-dark);
            flex-shrink: 0; /* Prevent header from shrinking */
        }

        .transcript-title {
            font-weight: 600;
            color: var(--text-primary-dark);
            font-size: 15px; /* Adjusted title size */
        }
        /* Assuming a .popup-close-btn is available and styled */

        .transcript-content {
            flex-grow: 1; /* Allow content to fill available space */
            overflow-y: auto;
            padding: 12px 16px; /* Padding for messages */
            display: flex;
            flex-direction: column;
            gap: 12px; /* Gap between messages */
        }

        .transcript-content::-webkit-scrollbar {
            width: 5px;
        }

        .transcript-content::-webkit-scrollbar-track {
            background: transparent; /* Invisible track */
        }

        .transcript-content::-webkit-scrollbar-thumb {
            background: var(--fill-secondary-dark); /* Subtle scrollbar thumb */
            border-radius: 5px;
        }

        .transcript-content::-webkit-scrollbar-thumb:hover {
            background: var(--fill-primary-dark);
        }

        .transcript-message {
            padding: 10px 14px; /* Message padding */
            border-radius: 18px; /* More rounded bubbles */
            transition: background-color 0.2s ease;
            max-width: 80%; 
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
        }

        .transcript-message.interviewer {
            background-color: var(--fill-tertiary-dark); /* Neutral bubble for interviewer */
            color: var(--text-primary-dark);
            align-self: flex-start;
            border-bottom-left-radius: 6px; /* Tail effect */
        }

        .transcript-message.candidate {
            background-color: var(--accent-apple-blue); /* Blue bubble for candidate/user */
            color: var(--accent-foreground-dark);
            align-self: flex-end;
            border-bottom-right-radius: 6px; /* Tail effect */
        }

        /* .transcript-message:hover removed for cleaner look, can be added back if desired */

        .message-header { /* This seems to be a sub-header within a message, might need to re-evaluate structure or remove if not used */
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px; /* Reduced margin */
        }

        .speaker-label { /* This is for the label above the bubble, not inside .message-header */
            font-weight: 500;
            font-size: 12px;
            color: var(--text-secondary-dark);
            margin-bottom: 3px; /* Space between label and bubble */
            padding: 0 2px;
        }





        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
        }

        .message-text {
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.5;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Compact draggable bar -->
    <div class="compact-bar" id="compactBar">

        
        <!-- Status indicator removed - button states provide sufficient feedback -->
        
        <div class="action-buttons">
            <button class="action-btn listen-now-btn" id="recordBtn" title="Start/Stop Recording">
                  <svg viewBox="0 0 24 24">
                      <g class="soundwave-bars">
                          <rect x="6" y="10" width="2" height="4" rx="1">
                              <animate attributeName="height" values="4;12;4" dur="1.2s" repeatCount="indefinite"/>
                              <animate attributeName="y" values="10;6;10" dur="1.2s" repeatCount="indefinite"/>
                          </rect>
                          <rect x="9" y="8" width="2" height="8" rx="1">
                              <animate attributeName="height" values="8;16;8" dur="1.5s" begin="0.2s" repeatCount="indefinite"/>
                              <animate attributeName="y" values="8;4;8" dur="1.5s" begin="0.2s" repeatCount="indefinite"/>
                          </rect>
                          <rect x="12" y="6" width="2" height="12" rx="1">
                              <animate attributeName="height" values="12;18;12" dur="1.8s" begin="0.4s" repeatCount="indefinite"/>
                              <animate attributeName="y" values="6;3;6" dur="1.8s" begin="0.4s" repeatCount="indefinite"/>
                          </rect>
                          <rect x="15" y="9" width="2" height="6" rx="1">
                              <animate attributeName="height" values="6;14;6" dur="1.3s" begin="0.6s" repeatCount="indefinite"/>
                              <animate attributeName="y" values="9;5;9" dur="1.3s" begin="0.6s" repeatCount="indefinite"/>
                          </rect>
                          <rect x="18" y="11" width="2" height="2" rx="1">
                              <animate attributeName="height" values="2;10;2" dur="1.1s" begin="0.8s" repeatCount="indefinite"/>
                              <animate attributeName="y" values="11;7;11" dur="1.1s" begin="0.8s" repeatCount="indefinite"/>
                          </rect>
                      </g>
                  </svg>
                  <span class="listen-text">Start Listen <span class="hotkey-hint">(⌘L)</span></span>
              </button>
            
            <button class="action-btn ai-btn" id="aiBtn" title="AI Answer (⌥S)">
                <span>Answer <span class="hotkey-hint">(⌘S)</span></span>
            </button>
            

        </div>
        
        <button class="action-btn expand-btn" id="expandBtn" title="Expand Menu">
            <svg viewBox="0 0 24 24" fill="white">
                <path d="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"/>
            </svg>
            <div class="tooltip">Menu</div>
        </button>
        
    </div>

    <!-- AI Suggestions Popup -->
    <div class="ai-popup" id="aiPopup">
        <div class="ai-popup-header">
            <div class="header-controls">
                 <!-- macOS Window Controls -->
                 <div class="window-controls">
                    <button class="window-control-btn close-popup-btn"  id="closePopup" title="close">
                        <svg width="12" height="10" viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 2L8 8M8 2L2 8"/>
                        </svg>
                    </button>
                    <button class="window-control-btn minimize-btn" id="aiMinimizeBtn" title="Minimize">
                        <svg width="12" height="12" viewBox="0 0 12 12">
                            <path d="M2 6H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <button class="window-control-btn maximize-btn" id="aiMaximizeBtn" title="Maximize">
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                            <path d="M2 4L4 2L6 4L4 6L2 4Z"/>
                            <path d="M6 8L8 6L10 8L8 10L6 8Z"/>
                        </svg>
                    </button>

                </div>
            </div>
            <div class="ai-popup-title">
            </div>
        </div>
        
        <div class="answer-card">
            <div class="answer-header">
                <div class="answer-title">AI Answer</div>
            </div>
            <div class="answer-text">
                "For system design, I'd focus on three key areas: scalability through horizontal scaling, load balancing with multiple servers, and database optimization using sharding techniques."
            </div>
            <div class="answer-actions">
                <button class="elaborate-btn" onclick="showElaboration(1)">
                    Elaborate
                </button>
                <button class="copy-btn" onclick="copyAnswer(this)">
                    <svg width="14" height="14" viewBox="0 0 24 24">
                        <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" fill="currentColor"/>
                    </svg>
                    Copy
                </button>
            </div>
        </div>
    </div>

    <!-- Preferences Panel (Initially Hidden) -->
    <div class="preferences-panel" id="preferencesPanel">
        <div class="preferences-header">
            <div class="preferences-title">Settings</div>
            <button class="window-control-btn" id="closePreferencesPanel">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" fill="currentColor"/>
                </svg>
            </button>
        </div>
        <div class="preferences-content">
            <div class="preference-item">
                <label for="themeToggle">Dark Mode</label>
                <label class="switch">
                    <input type="checkbox" id="themeToggle" checked>
                    <span class="slider round"></span>
                </label>
            </div>

             <div class="preference-item">
                <label for="aiModelSelect">AI Model</label>
                <select id="aiModelSelect" class="preference-select">
                    <option value="gpt-4">GPT-4 (Advanced)</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast)</option>
                    <option value="claude-2">Claude 2 (Balanced)</option>
                </select>
            </div>
            <div class="preference-item">
                <label for="autoRecordToggle">Auto-start Recording on Launch</label>
                <label class="switch">
                    <input type="checkbox" id="autoRecordToggle">
                    <span class="slider round"></span>
                </label>
            </div>

                    <!-- Context Upload Section -->
                    <h3 class="context-section-title">Contextual Information</h3>
                    <div class="context-upload-section">
                        <div class="preference-item">
                            <label for="resumeUpload" class="preference-item-label">Upload Resume</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="resumeUpload" accept=".pdf,.doc,.docx,.txt">
                                <button type="button" class="file-input-button" onclick="document.getElementById('resumeUpload').click();">Choose File</button>
                                <span class="file-name-display" id="resumeFileName">No file chosen</span>
                                <button type="button" class="clear-file-btn" id="clearResumeBtn" onclick="clearFile('resumeUpload', 'resumeFileName', 'clearResumeBtn')">Clear</button>
                            </div>
                        </div>
                        <div class="preference-item">
                            <label for="jobDescUpload" class="preference-item-label">Upload Job Description</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="jobDescUpload" accept=".pdf,.doc,.docx,.txt">
                                <button type="button" class="file-input-button" onclick="document.getElementById('jobDescUpload').click();">Choose File</button>
                                <span class="file-name-display" id="jobDescFileName">No file chosen</span>
                                <button type="button" class="clear-file-btn" id="clearJobDescBtn" onclick="clearFile('jobDescUpload', 'jobDescFileName', 'clearJobDescBtn')">Clear</button>
                            </div>
                        </div>
                    </div>
        </div>
    </div>

    <!-- Expanded Menu Panel -->
    <div class="expanded-menu" id="expandedMenu">
        <div class="menu-header">
            <div class="menu-title">Menu</div>
            <button class="menu-control-btn" id="closeExpandedMenu" title="close">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 3L9 9M9 3L3 9"/>
                    </svg>
                </button>
        </div>
        
        <!-- User Section -->
        <div class="menu-section">
            <div class="user-info" id="userInfo" style="display: none;">
                <div class="user-avatar">JD</div>
                <div class="user-details">
                    <div class="user-name">John Doe</div>
                    <div class="user-status">Premium User</div>
                </div>
            </div>
            
            <div class="login-prompt" id="loginPrompt">
                <div style="margin-bottom: 8px;">Sign in to start using the app</div>
                <button class="login-btn" id="loginBtn">Sign In</button>
            </div>
        </div>
        
        <!-- Account Section -->
        <div class="menu-section" id="accountSection" style="display: none;">
            <div class="menu-section-title">Account</div>
            <div class="menu-item" id="profileItem">
                <div class="menu-item-content">
                    <svg class="menu-item-icon" viewBox="0 0 24 24">
                        <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" fill="currentColor"/>
                    </svg>
                    <span class="menu-item-text">Profile</span>
                </div>

            </div>
            <div class="menu-item" id="subscriptionItem">
                <div class="menu-item-content">
                    <svg class="menu-item-icon" viewBox="0 0 24 24">
                        <path d="M7,15H9C9,16.08 10.37,17 12,17C13.63,17 15,16.08 15,15C15,13.9 13.96,13.5 11.76,12.97C9.64,12.44 7,11.78 7,9C7,7.21 8.47,5.69 10.5,5.18V3H13.5V5.18C15.53,5.69 17,7.21 17,9H15C15,7.92 13.63,7 12,7C10.37,7 9,7.92 9,9C9,10.1 10.04,10.5 12.24,11.03C14.36,11.56 17,12.22 17,15C17,16.79 15.53,18.31 13.5,18.82V21H10.5V18.82C8.47,18.31 7,16.79 7,15Z" fill="currentColor"/>
                    </svg>
                    <span class="menu-item-text">Subscription</span>
                </div>
            </div>
            <div class="menu-item" id="logoutItem">
                <div class="menu-item-content">
                    <svg class="menu-item-icon" viewBox="0 0 24 24">
                        <path d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z" fill="currentColor"/>
                    </svg>
                    <span class="menu-item-text">Sign Out</span>
                </div>
            </div>
            <div class="transcript-title">Transcript</div>
        </div>
        
        <!-- General Section -->
        <div class="menu-section">
            <div class="menu-section-title">General</div>
            <div class="menu-item" id="settingsItem">
                <div class="menu-item-content">
                    <svg class="menu-item-icon" viewBox="0 0 24 24">
                        <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" fill="currentColor"/>
                    </svg>
                    <span class="menu-item-text">Settings</span>
                </div>
            </div>

            <div class="menu-item" id="keyboardShortcutsItem">
                <div class="menu-item-content">
                    <svg class="menu-item-icon" viewBox="0 0 24 24">
                        <path d="M19,10H17V8H19M19,13H17V11H19M16,10H14V8H16M16,13H14V11H16M16,17H14V15H16M7,10H5V8H7M7,13H5V11H7M8,10H10V8H8M8,13H10V11H8M11,10H13V8H11M11,13H13V11H11M11,17H13V15H11M20,5H4C2.89,5 2,5.89 2,7V17C2,18.11 2.89,19 4,19H20C21.11,19 22,18.11 22,17V7C22,5.89 21.11,5 20,5Z" fill="currentColor"/>
                    </svg>
                    <span class="menu-item-text">Keyboard Shortcuts</span>
                </div>
            </div>
            <div class="menu-item" id="showTranscriptItem">
                <div class="menu-item-content">
                    <svg class="menu-item-icon" viewBox="0 0 24 24">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" fill="currentColor"/>
                    </svg>
                    <span class="menu-item-text">Show Transcript</span>
                </div>
            </div>
        </div>
        
        <!-- Help Section -->
        <div class="menu-section">
            <div class="menu-section-title">Help & Support</div>
            <div class="menu-item" id="helpItem">
                <div class="menu-item-content">
                    <svg class="menu-item-icon" viewBox="0 0 24 24">
                        <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z" fill="currentColor"/>
                    </svg>
                    <span class="menu-item-text">Help Center</span>
                </div>
            </div>
            <div class="menu-item" id="quitItem">
                <div class="menu-item-content">
                    <svg class="menu-item-icon" viewBox="0 0 24 24">
                        <path d="M19,3H5C3.89,3 3,3.89 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M10.08,15.58L11.5,17L16.5,12L11.5,7L10.08,8.41L12.67,11H3V13H12.67L10.08,15.58Z" fill="currentColor"/>
                    </svg>
                    <span class="menu-item-text">Quit</span>
                </div>
            </div>

        </div>
    </div>

    <!-- Transcript Panel -->
    <div class="transcript-panel" id="transcriptPanel">
        <div class="transcript-header">
            <div class="header-controls">
                <!-- macOS Window Controls -->
                <div class="window-controls">
                    <button class="window-control-btn close-popup-btn" id="closeTranscriptPanel" color="red" title="close">
                        <svg width="12" height="10" viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 2L8 8M8 2L2 8"/>
                        </svg>
                    </button>
                    <button class="window-control-btn minimize-btn" id="transcriptMinimizeBtn" title="Minimize">
                        <svg width="12" height="12" viewBox="0 0 12 12">
                            <path d="M2 6H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <button class="window-control-btn maximize-btn" id="transcriptMaximizeBtn" title="Maximize">
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                            <path d="M2 4L4 2L6 4L4 6L2 4Z"/>
                            <path d="M6 8L8 6L10 8L8 10L6 8Z"/>
                        </svg>
                    </button>
                    
                </div>
            </div>
        </div>
        <div class="transcript-content" id="transcriptContent">
            <div class="transcript-message interviewer">
                <div class="message-header">
                    <span class="speaker-label">Interviewer</span>
                    <span class="message-time">10:30 AM</span>
                </div>
                <div class="message-text">Tell me about your experience with JavaScript frameworks.</div>
            </div>
            <div class="transcript-message candidate">
                <div class="message-header">
                    <span class="speaker-label">You</span>
                    <span class="message-time">10:30 AM</span>
                </div>
                <div class="message-text">I have extensive experience with React, Vue, and Angular. I've been working with React for the past 3 years...</div>
            </div>
            <div class="transcript-message interviewer">
                <div class="message-header">
                    <span class="speaker-label">Interviewer</span>
                    <span class="message-time">10:31 AM</span>
                </div>
                <div class="message-text">Can you walk me through how you would optimize a React application for performance?</div>
            </div>
        </div>
    </div>

    <script>
        // Dragging functionality
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        const compactBar = document.getElementById('compactBar');
        const aiPopup = document.getElementById('aiPopup');
        const expandedMenu = document.getElementById('expandedMenu');
        // Status indicator removed
        const recordBtn = document.getElementById('recordBtn');
        const aiBtn = document.getElementById('aiBtn');
        const expandBtn = document.getElementById('expandBtn');
        const minimizeBtn = document.getElementById('minimizeBtn');
        const closePopup = document.getElementById('closePopup');
        const closeExpandedMenu = document.getElementById('closeExpandedMenu');

        // Preferences Panel elements
        const settingsItem = document.getElementById('settingsItem'); // Renamed from preferencesItem
        const preferencesPanel = document.getElementById('preferencesPanel');
        const closePreferencesPanelBtn = document.getElementById('closePreferencesPanel');

        // Transcript Panel elements
        const showTranscriptItem = document.getElementById('showTranscriptItem');
        const transcriptPanel = document.getElementById('transcriptPanel');
        const closeTranscriptPanelBtn = document.getElementById('closeTranscriptPanel');

        // File Upload Handling
        function setupFileUpload(inputId, fileNameId, clearBtnId) {
            const fileInput = document.getElementById(inputId);
            const fileNameDisplay = document.getElementById(fileNameId);
            const clearButton = document.getElementById(clearBtnId);

            if (fileInput && fileNameDisplay && clearButton) {
                fileInput.addEventListener('change', function() {
                    if (this.files && this.files.length > 0) {
                        fileNameDisplay.textContent = this.files[0].name;
                        clearButton.style.visibility = 'visible';
                    } else {
                        fileNameDisplay.textContent = 'No file chosen';
                        clearButton.style.visibility = 'hidden';
                    }
                });
            }
        }

        function clearFile(inputId, fileNameId, clearBtnId) {
            const fileInput = document.getElementById(inputId);
            const fileNameDisplay = document.getElementById(fileNameId);
            const clearButton = document.getElementById(clearBtnId);

            if (fileInput) fileInput.value = ''; // Clear the file input
            if (fileNameDisplay) fileNameDisplay.textContent = 'No file chosen';
            if (clearButton) clearButton.style.visibility = 'hidden';
        }

        setupFileUpload('resumeUpload', 'resumeFileName', 'clearResumeBtn');
        setupFileUpload('jobDescUpload', 'jobDescFileName', 'clearJobDescBtn');

        // Initialize file upload display
        clearFile('resumeUpload', 'resumeFileName', 'clearResumeBtn');
        clearFile('jobDescUpload', 'jobDescFileName', 'clearJobDescBtn');

        
        // Menu elements
        const userInfo = document.getElementById('userInfo');
        const loginPrompt = document.getElementById('loginPrompt');
        const accountSection = document.getElementById('accountSection');
        const loginBtn = document.getElementById('loginBtn');
        const logoutItem = document.getElementById('logoutItem');
        
        // Track login state
        let isLoggedIn = false;

        // Drag functionality
        compactBar.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        function dragStart(e) {
            if (e.target.closest('.action-btn')) return; // Don't drag when clicking buttons
            
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;

            if (e.target === compactBar || e.target.closest('.brand')) {
                isDragging = true;
                compactBar.style.cursor = 'grabbing';
            }
        }

        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                xOffset = currentX;
                yOffset = currentY;

                compactBar.style.transform = `translate(${currentX}px, ${currentY}px)`;
            }
        }

        function dragEnd() {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
            compactBar.style.cursor = 'move';
        }

        // Hotkey listener
        document.addEventListener('keydown', (event) => {
            if (event.metaKey) {
                switch (event.key.toLowerCase()) {
                    case 'l':
                        event.preventDefault();
                        recordBtn.click();
                        break;
                    case 's': // Changed from altKey to metaKey for ⌘S
                        event.preventDefault();
                        aiBtn.click();
                        break;
                }
            }
        });

        // Answer interaction functions
        function speakAnswer(button) {
            const answerText = button.closest('.answer-card').querySelector('.answer-text').textContent;
            
            // Visual feedback
            button.style.background = 'var(--secondary-hover)';
            button.innerHTML = `
                <svg width="14" height="14" viewBox="0 0 24 24">
                    <path d="M12,2A2,2 0 0,1 14,4V20A2,2 0 0,1 12,22A2,2 0 0,1 10,20V4A2,2 0 0,1 12,2Z" fill="currentColor"/>
                </svg>
                Speaking...
            `;
            
            // Simulate speech (in real app, this would use speech synthesis)
            setTimeout(() => {
                button.style.background = 'var(--secondary)';
                button.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 24 24">
                        <path d="M3,9V15H7L12,20V4L7,9H3M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12Z" fill="currentColor"/>
                    </svg>
                    Speak This
                `;
            }, 2000);
            
            console.log('Speaking:', answerText);
        }

        function showElaboration(answerId) {
            const elaborations = {
                1: "Let me elaborate on system design: First, for scalability, I'd implement horizontal scaling using load balancers like NGINX or AWS ALB to distribute traffic across multiple server instances. For the database layer, I'd use sharding to partition data across multiple databases, ensuring each shard handles a specific range of data. Additionally, I'd implement caching strategies using Redis or Memcached to reduce database load and improve response times.",
                2: "Here's my detailed problem-solving approach: I start by gathering all requirements and constraints, then I break the problem into smaller, manageable components. For example, when I worked on optimizing a slow API, I first identified bottlenecks through profiling, then systematically addressed each issue - database query optimization, caching implementation, and code refactoring. I always document my thought process and test each solution incrementally."
            };
            
            alert(`Elaboration:\n\n${elaborations[answerId]}`);
        }

        function copyAnswer(button) {
            const answerText = button.closest('.answer-card').querySelector('.answer-text').textContent;
            
            // Copy to clipboard
            navigator.clipboard.writeText(answerText).then(() => {
                // Visual feedback
                const originalContent = button.innerHTML;
                button.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 24 24">
                        <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" fill="currentColor"/>
                    </svg>
                    Copied!
                `;
                button.style.background = 'var(--secondary-hover-transparent)'; /* Assuming this is for a subtle success indication */
                button.style.color = 'var(--secondary)';
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                    /* Assuming default button styles are handled by CSS classes, so direct style removal or reset might be better here if applicable */
                    /* For now, let's use a generic light background and text color if no specific variable fits */
                    button.style.background = 'rgba(255, 255, 255, 0.1)'; 
                    button.style.color = 'var(--primary-foreground)'; /* Or a more general text color variable if available */
                }, 1500);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        // Button functionality
        let isRecording = false;
        let isProcessing = false;

        recordBtn.addEventListener('click', () => {
            isRecording = !isRecording;
            recordBtn.classList.toggle('active', isRecording);
            
            // Update button text based on recording state
            const listenText = recordBtn.querySelector('.listen-text');
            const hotkeyHint = recordBtn.querySelector('.hotkey-hint').outerHTML; // Store the hotkey hint HTML
            listenText.innerHTML = isRecording ? `Stop Listen ${hotkeyHint}` : `Start Listen ${hotkeyHint}`;
            
            // Status feedback now handled by button active state only
        });

        aiBtn.addEventListener('click', () => {
            // Close expanded menu if open
            expandedMenu.classList.remove('show');
            expandBtn.classList.remove('active');
            
            aiPopup.classList.toggle('show');
            aiBtn.classList.toggle('active', aiPopup.classList.contains('show'));
            preferencesPanel.classList.remove('show'); // Close preferences if open
        });

        closePopup.addEventListener('click', () => {
            aiPopup.classList.remove('show');
            aiBtn.classList.remove('active');
        });
        
        // Expand menu functionality
        expandBtn.addEventListener('click', () => {
            // Close AI popup and preferences panel if open
            aiPopup.classList.remove('show');
            aiBtn.classList.remove('active');
            preferencesPanel.classList.remove('show');
            
            expandedMenu.classList.toggle('show');
            expandBtn.classList.toggle('active', expandedMenu.classList.contains('show'));
        });
        
        closeExpandedMenu.addEventListener('click', () => {
            expandedMenu.classList.remove('show');
            expandBtn.classList.remove('active');
        });

        // Preferences Panel Functionality
        settingsItem.addEventListener('click', (event) => {
            event.stopPropagation();
            preferencesPanel.classList.toggle('show');
            // Close other popups
            expandedMenu.classList.remove('show');
            expandBtn.classList.remove('active');
            aiPopup.classList.remove('show');
            aiBtn.classList.remove('active');
        });

        closePreferencesPanelBtn.addEventListener('click', () => {
            preferencesPanel.classList.remove('show');
        });

        // Transcript Panel Functionality
        showTranscriptItem.addEventListener('click', (event) => {
            event.stopPropagation();
            transcriptPanel.classList.toggle('show');
            // Close other popups
            expandedMenu.classList.remove('show');
            expandBtn.classList.remove('active');
            aiPopup.classList.remove('show');
            aiBtn.classList.remove('active');
            preferencesPanel.classList.remove('show');
        });

        closeTranscriptPanelBtn.addEventListener('click', () => {
            transcriptPanel.classList.remove('show');
        });
        
        // Login/Logout functionality
        function updateLoginState() {
            if (isLoggedIn) {
                userInfo.style.display = 'flex';
                loginPrompt.style.display = 'none';
                accountSection.style.display = 'block';
            } else {
                userInfo.style.display = 'none';
                loginPrompt.style.display = 'block';
                accountSection.style.display = 'none';
            }
        }
        
        loginBtn.addEventListener('click', () => {
            isLoggedIn = true;
            updateLoginState();
            // Simulate login success
            setTimeout(() => {
                alert('Successfully signed in!');
            }, 100);
        });
        
        logoutItem.addEventListener('click', () => {
            isLoggedIn = false;
            updateLoginState();
            expandedMenu.classList.remove('show');
            expandBtn.classList.remove('active');
            preferencesPanel.classList.remove('show'); // Close preferences on logout
            alert('Successfully signed out!');
        });
        
        // Window Controls Functionality for AI Popup
        document.getElementById('aiMinimizeBtn').addEventListener('click', () => {
            // In a real Electron app, this would minimize the AI popup
            alert('AI popup minimize functionality');
        });
        
        document.getElementById('aiMaximizeBtn').addEventListener('click', () => {
            // In a real Electron app, this would maximize the AI popup
            alert('AI popup maximize functionality');
        });

        // Window Controls Functionality for Transcript Panel
        document.getElementById('transcriptMinimizeBtn').addEventListener('click', () => {
            // In a real Electron app, this would minimize the transcript panel
            alert('Transcript panel minimize functionality');
        });
        
        document.getElementById('transcriptMaximizeBtn').addEventListener('click', () => {
            // In a real Electron app, this would maximize the transcript panel
            alert('Transcript panel maximize functionality');
        });

        // Menu item click handlers (excluding settingsItem, handled above)
        document.getElementById('profileItem').addEventListener('click', () => {
            alert('Profile settings would open here');
            preferencesPanel.classList.remove('show');
            expandedMenu.classList.remove('show');
            expandBtn.classList.remove('active');
        });
        
        document.getElementById('subscriptionItem').addEventListener('click', () => {
            alert('Subscription management would open here');
            preferencesPanel.classList.remove('show');
            expandedMenu.classList.remove('show');
            expandBtn.classList.remove('active');
        });
        
        // preferencesItem is now settingsItem and has its own handler
        
        document.getElementById('keyboardShortcutsItem').addEventListener('click', () => {
            alert('Keyboard shortcuts help would open here');
        });
        
        document.getElementById('helpItem').addEventListener('click', () => {
            alert('Help center would open here');
        });
        
        document.getElementById('quitItem').addEventListener('click', () => {
            if (confirm('Are you sure you want to quit?')) {
                alert('Application would quit here');
            }
        });
        
        // Initialize login state
        updateLoginState();

        minimizeBtn.addEventListener('click', () => {
            compactBar.style.transform = 'translateX(-50%) scale(0.8)';
            compactBar.style.opacity = '0.7';
            
            setTimeout(() => {
                compactBar.style.transform = 'translateX(-50%) scale(1)';
                compactBar.style.opacity = '1';
            }, 200);
        });

        // Suggestion button functionality
        document.querySelectorAll('.suggestion-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                if (btn.textContent === 'Use Suggestion') {
                    btn.textContent = 'Applied ✓';
                    btn.style.background = 'var(--secondary)'; /* Or a specific success color if defined */
                    setTimeout(() => {
                        btn.closest('.ai-suggestion').style.opacity = '0.5';
                    }, 500);
                } else if (btn.textContent === 'Dismiss') {
                    btn.closest('.ai-suggestion').style.display = 'none';
                }
            });
        });

        // Close popups when clicking outside
        document.addEventListener('click', (e) => {
            // Close AI popup if clicking outside
            if (!aiPopup.contains(e.target) && !aiBtn.contains(e.target)) {
                aiPopup.classList.remove('show');
                aiBtn.classList.remove('active');
            }
            
            // Close expanded menu if clicking outside
            if (!expandedMenu.contains(e.target) && !expandBtn.contains(e.target) && !settingsItem.contains(e.target)) {
                expandedMenu.classList.remove('show');
                expandBtn.classList.remove('active');
            }

            // Close preferences panel if clicking outside
            if (!preferencesPanel.contains(e.target) && !settingsItem.contains(e.target)) {
                preferencesPanel.classList.remove('show');
            }
        });

        // Simulate AI suggestions appearing
        setTimeout(() => {
            if (Math.random() > 0.5) {
                aiBtn.style.animation = 'pulse 1s ease-in-out 3';
            }
        }, 5000);
    </script>
</body>
</html>